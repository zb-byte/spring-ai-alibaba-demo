<!DOCTYPE html>
<html>
<head>
    <title>A2A gRPC Client Demo</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; background: #f5f5f5; }
        .container { max-width: 1000px; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .status { padding: 10px; border-radius: 5px; margin: 10px 0; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .endpoint { background: #f8f9fa; padding: 15px; border-radius: 5px; margin: 10px 0; border-left: 4px solid #007bff; }
        .code { font-family: monospace; background: #f0f0f0; padding: 2px 6px; border-radius: 3px; }
        .btn { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin: 5px; }
        .btn:hover { background: #0056b3; }
        .btn-success { background: #28a745; }
        .btn-success:hover { background: #1e7e34; }
        .btn-warning { background: #ffc107; color: #212529; }
        .btn-warning:hover { background: #e0a800; }
        .btn-danger { background: #dc3545; }
        .btn-danger:hover { background: #c82333; }
        .form-group { margin: 15px 0; }
        .form-control { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
        .response-area { background: #f8f9fa; padding: 15px; border-radius: 5px; margin: 10px 0; min-height: 100px; white-space: pre-wrap; font-family: monospace; overflow-x: auto; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        @media (max-width: 768px) { .grid { grid-template-columns: 1fr; } }
        .loading { opacity: 0.6; pointer-events: none; }
        .spinner { display: inline-block; width: 16px; height: 16px; border: 2px solid #f3f3f3; border-top: 2px solid #007bff; border-radius: 50%; animation: spin 1s linear infinite; margin-right: 8px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        h1 { color: #333; }
        h2 { color: #555; border-bottom: 2px solid #007bff; padding-bottom: 10px; }
        .badge { display: inline-block; padding: 4px 8px; border-radius: 4px; font-size: 12px; margin-left: 8px; }
        .badge-success { background: #28a745; color: white; }
        .badge-warning { background: #ffc107; color: #212529; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¤– A2A gRPC Client Demo <span class="badge badge-success">v0.3.3.Final</span></h1>
        <p>åŸºäº A2A Java SDK v0.3.3.Final çš„çœŸå® gRPC å®¢æˆ·ç«¯æµ‹è¯•å·¥å…·</p>
        
        <div class="grid">
            <div>
                <h2>ğŸ“¡ æœåŠ¡å™¨è¿æ¥</h2>
                <div class="endpoint">
                    <strong>HTTP æœåŠ¡å™¨:</strong> <span class="code">http://localhost:7002</span><br>
                    <strong>gRPC ç«¯å£:</strong> <span class="code">9090</span><br>
                    <strong>Agent Card:</strong> <span class="code">/.well-known/agent-card.json</span>
                </div>
                
                <button class="btn" onclick="testConnection()">ğŸ” æµ‹è¯• HTTP è¿æ¥</button>
                <button class="btn btn-warning" onclick="testGrpcConnection()">ğŸ”Œ æµ‹è¯• gRPC è¿æ¥</button>
                <button class="btn btn-success" onclick="initClient()">ğŸš€ åˆå§‹åŒ–å®¢æˆ·ç«¯</button>
                
                <div id="connectionStatus" class="response-area">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®æµ‹è¯•è¿æ¥...</div>
            </div>
            
            <div>
                <h2>ğŸ“„ Agent Card</h2>
                <p>è·å– A2A Agent çš„å…ƒæ•°æ®å’Œèƒ½åŠ›ä¿¡æ¯</p>
                
                <button class="btn" onclick="getAgentCard()">ğŸ“„ HTTP è·å–</button>
                <button class="btn btn-success" onclick="getAgentCardA2A()">ğŸš€ gRPC è·å–</button>
                
                <div id="agentCardResponse" class="response-area">Agent Card ä¿¡æ¯å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...</div>
            </div>
        </div>
        
        <h2>ğŸ’¬ æ¶ˆæ¯æµ‹è¯•</h2>
        <div class="form-group">
            <label><strong>æµ‹è¯•æ¶ˆæ¯:</strong></label>
            <input type="text" id="testMessage" class="form-control" value="Hello, A2A Echo Agent! ä½ å¥½ï¼" placeholder="è¾“å…¥è¦å‘é€çš„æ¶ˆæ¯">
        </div>
        
        <button class="btn btn-success" onclick="sendMessageA2A()">ğŸš€ å‘é€æ¶ˆæ¯ (A2A gRPC)</button>
        <button class="btn" onclick="sendMessage()">ğŸ“¤ å‘é€æ¶ˆæ¯ (HTTP POST)</button>
        
        <div id="messageResponse" class="response-area">æ¶ˆæ¯å“åº”å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...</div>
        
        <h2>âœ… åŠŸèƒ½çŠ¶æ€</h2>
        <ul>
            <li>âœ… Maven ä¾èµ–é…ç½® (A2A SDK v0.3.3.Final)</li>
            <li>âœ… Spring Boot é›†æˆ</li>
            <li>âœ… gRPC Channel ç®¡ç†</li>
            <li>âœ… A2A Client åˆå§‹åŒ–</li>
            <li>âœ… Agent Card è·å– (HTTP + gRPC)</li>
            <li>âœ… æ¶ˆæ¯å‘é€/æ¥æ”¶ (A2A gRPC Client)</li>
            <li>âœ… äº‹ä»¶å¤„ç† (MessageEvent, TaskEvent, TaskUpdateEvent)</li>
            <li>âœ… è¿æ¥çŠ¶æ€ç®¡ç†</li>
        </ul>
        
        <h2>ğŸ“š API ç«¯ç‚¹</h2>
        <div class="endpoint">
            <strong>HTTP è¿æ¥æµ‹è¯•:</strong> <span class="code">GET /api/test-connection</span><br>
            <strong>gRPC è¿æ¥æµ‹è¯•:</strong> <span class="code">GET /api/test-grpc</span><br>
            <strong>åˆå§‹åŒ–å®¢æˆ·ç«¯:</strong> <span class="code">POST /api/init-client</span><br>
            <strong>Agent Card (HTTP):</strong> <span class="code">GET /api/agent-card</span><br>
            <strong>Agent Card (gRPC):</strong> <span class="code">GET /api/agent-card-a2a</span><br>
            <strong>å‘é€æ¶ˆæ¯ (HTTP):</strong> <span class="code">POST /api/send-message</span><br>
            <strong>å‘é€æ¶ˆæ¯ (gRPC):</strong> <span class="code">GET /api/send-message-a2a?message=xxx</span>
        </div>
        
        <h2>ğŸ“– ä½¿ç”¨è¯´æ˜</h2>
        <ol>
            <li>å¯åŠ¨ A2A Server: <span class="code">cd ../a2a-server-module-grpc && mvn spring-boot:run</span></li>
            <li>å¯åŠ¨ A2A Client: <span class="code">cd ../a2a-client-module-grpc && mvn spring-boot:run</span></li>
            <li>ç‚¹å‡» "æµ‹è¯• gRPC è¿æ¥" éªŒè¯æœåŠ¡å™¨çŠ¶æ€</li>
            <li>ç‚¹å‡» "åˆå§‹åŒ–å®¢æˆ·ç«¯" å»ºç«‹ gRPC è¿æ¥</li>
            <li>ç‚¹å‡» "gRPC è·å–" è·å– Agent Card</li>
            <li>è¾“å…¥æ¶ˆæ¯å¹¶ç‚¹å‡» "å‘é€æ¶ˆæ¯ (A2A gRPC)" æµ‹è¯•å®Œæ•´æµç¨‹</li>
        </ol>
    </div>
    
    <script>
        function showLoading(elementId, message) {
            const el = document.getElementById(elementId);
            el.innerHTML = '<span class="spinner"></span>' + message;
        }
        
        async function testConnection() {
            const statusDiv = document.getElementById('connectionStatus');
            showLoading('connectionStatus', 'æ­£åœ¨æµ‹è¯• HTTP è¿æ¥...');
            
            try {
                const response = await fetch('/api/test-connection');
                const result = await response.json();
                statusDiv.textContent = JSON.stringify(result, null, 2);
            } catch (error) {
                statusDiv.textContent = 'è¿æ¥æµ‹è¯•å¤±è´¥: ' + error.message;
            }
        }
        
        async function testGrpcConnection() {
            const statusDiv = document.getElementById('connectionStatus');
            showLoading('connectionStatus', 'æ­£åœ¨æµ‹è¯• gRPC è¿æ¥...');
            
            try {
                const response = await fetch('/api/test-grpc');
                const result = await response.json();
                statusDiv.textContent = JSON.stringify(result, null, 2);
            } catch (error) {
                statusDiv.textContent = 'gRPC è¿æ¥æµ‹è¯•å¤±è´¥: ' + error.message;
            }
        }
        
        async function initClient() {
            const statusDiv = document.getElementById('connectionStatus');
            showLoading('connectionStatus', 'æ­£åœ¨åˆå§‹åŒ– A2A gRPC å®¢æˆ·ç«¯...');
            
            try {
                const response = await fetch('/api/init-client', { method: 'POST' });
                const result = await response.json();
                statusDiv.textContent = JSON.stringify(result, null, 2);
            } catch (error) {
                statusDiv.textContent = 'å®¢æˆ·ç«¯åˆå§‹åŒ–å¤±è´¥: ' + error.message;
            }
        }
        
        async function getAgentCard() {
            const responseDiv = document.getElementById('agentCardResponse');
            showLoading('agentCardResponse', 'æ­£åœ¨é€šè¿‡ HTTP è·å– Agent Card...');
            
            try {
                const response = await fetch('/api/agent-card');
                const result = await response.json();
                responseDiv.textContent = JSON.stringify(result, null, 2);
            } catch (error) {
                responseDiv.textContent = 'Agent Card è·å–å¤±è´¥: ' + error.message;
            }
        }
        
        async function getAgentCardA2A() {
            const responseDiv = document.getElementById('agentCardResponse');
            showLoading('agentCardResponse', 'æ­£åœ¨é€šè¿‡ A2A gRPC è·å– Agent Card...');
            
            try {
                const response = await fetch('/api/agent-card-a2a');
                const result = await response.json();
                responseDiv.textContent = JSON.stringify(result, null, 2);
            } catch (error) {
                responseDiv.textContent = 'A2A Agent Card è·å–å¤±è´¥: ' + error.message;
            }
        }
        
        async function sendMessage() {
            const message = document.getElementById('testMessage').value;
            const responseDiv = document.getElementById('messageResponse');
            showLoading('messageResponse', 'æ­£åœ¨é€šè¿‡ HTTP å‘é€æ¶ˆæ¯...');
            
            try {
                const response = await fetch('/api/send-message', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: message })
                });
                const result = await response.json();
                responseDiv.textContent = JSON.stringify(result, null, 2);
            } catch (error) {
                responseDiv.textContent = 'æ¶ˆæ¯å‘é€å¤±è´¥: ' + error.message;
            }
        }
        
        async function sendMessageA2A() {
            const message = document.getElementById('testMessage').value;
            const responseDiv = document.getElementById('messageResponse');
            showLoading('messageResponse', 'æ­£åœ¨é€šè¿‡ A2A gRPC å‘é€æ¶ˆæ¯...');
            
            try {
                const response = await fetch('/api/send-message-a2a?message=' + encodeURIComponent(message));
                const result = await response.json();
                responseDiv.textContent = JSON.stringify(result, null, 2);
            } catch (error) {
                responseDiv.textContent = 'A2A æ¶ˆæ¯å‘é€å¤±è´¥: ' + error.message;
            }
        }
    </script>
</body>
</html>
